<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>私密媒体分享 - 媒体管理</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>媒体管理中心</h1>
        
        <!-- 登出按钮 -->
        <button class="btn btn-logout" onclick="logout()">退出登录</button>
        
        <!-- 提示框 -->
        <div id="message-alert" class="alert" style="display: none;"></div>
        
        <!-- 文件上传区域 -->
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <input type="file" id="file-input" accept="image/*,video/*" multiple onchange="handleFiles(this.files)">
            <div class="upload-text">点击或拖拽文件到此处上传（仅本地预览）</div>
            <p>支持格式：JPG/PNG/GIF/MP4/AVI/MOV/MKV</p>
        </div>
        
        <!-- 媒体预览网格 -->
        <h2 style="margin-bottom: 15px; color: #2c3e50;">已选择的媒体</h2>
        <div class="media-grid" id="media-grid"></div>
    </div>

    <script>
        // 检查登录状态，未登录则跳转登录页
        if (localStorage.getItem("authenticated") !== "true") {
            window.location.href = "index.html";
        }

        // 登出函数
        function logout() {
            localStorage.removeItem("authenticated");
            localStorage.removeItem("accessKey");
            window.location.href = "index.html";
        }

        // 处理文件选择
        function handleFiles(files) {
            if (files.length === 0) return;
            
            const mediaGrid = document.getElementById("media-grid");
            const messageAlert = document.getElementById("message-alert");
            
            // 清空之前的提示
            messageAlert.style.display = "none";
            
            // 遍历选择的文件
            for (const file of files) {
                // 验证文件类型
                const fileType = file.type.split("/")[0];
                if (!["image", "video"].includes(fileType)) {
                    showMessage("不支持的文件类型：" + file.name, "error");
                    continue;
                }
                
                // 创建媒体项
                const mediaItem = document.createElement("div");
                mediaItem.className = "media-item";
                
                // 创建媒体元素
                const mediaElement = fileType === "image" 
                    ? document.createElement("img") 
                    : document.createElement("video");
                
                // 设置预览URL
                const fileURL = URL.createObjectURL(file);
                mediaElement.src = fileURL;
                if (fileType === "video") {
                    mediaElement.controls = true; // 视频显示控制栏
                    mediaElement.muted = true; // 静音（避免自动播放问题）
                }
                
                // 创建文件名标签
                const nameLabel = document.createElement("div");
                nameLabel.className = "media-name";
                nameLabel.textContent = file.name;
                
                // 组装媒体项
                mediaItem.appendChild(mediaElement);
                mediaItem.appendChild(nameLabel);
                mediaGrid.appendChild(mediaItem);
                
                // 释放URL（防止内存泄漏）
                mediaElement.onload = () => {
                    URL.revokeObjectURL(fileURL);
                };
            }
            
            showMessage("成功加载 " + files.length + " 个媒体文件（仅本地预览）", "success");
        }

        // 显示提示信息
        function showMessage(text, type) {
            const messageAlert = document.getElementById("message-alert");
            messageAlert.textContent = text;
            messageAlert.className = "alert " + (type === "error" ? "alert-error" : "alert-success");
            messageAlert.style.display = "block";
            
            // 3秒后自动隐藏
            setTimeout(() => {
                messageAlert.style.display = "none";
            }, 3000);
        }
    </script>
</body>
</html>
